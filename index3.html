<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>video</title>
  <link rel="stylesheet" href="track.css">

  <link rel="apple-touch-icon" sizes="180x180"
        href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32"
        href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16"
        href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#00aba9">
  <meta name="theme-color" content="#ffffff">
</head>

<body>
  
  <canvas id="canvas" class="canvasbox"></canvas>
  <video playsinline id="myvideo"
	 height="360" width="520"
	 style="visibility: visible;
                position:absolute;
                left: 0;
                top:0"></video>

  <div style="position:absolute; top:0px; right:0px;">
  <div id="updatenote" class="updatenote mt10"> Loading Model ..</div>
  <div id="flip_button" class="updatenote mt10"
       style="visibility:hidden;"
       onclick="flip_function()">Flip Image</div>
  <div id="thresh_button1" class="updatenote mt10"
       style="visibility:visible;"
       onclick="thresh_increase(0.1)">T+</div>
  <div id="thresh_button2" class="updatenote mt10"
       style="visibility:visible;"
       onclick="thresh_increase(-0.1)">T-</div>
  <div id="thresh_button3" class="updatenote mt10"
       style="visibility:visible;">Thresh</div>
  </div>

  <script>

    const video = document.getElementById("myvideo");
    let updateNote = document.getElementById("updatenote");
    
    function startVideo(video) {
  // Video must have height and width in order to be used as input for NN
  // Aspect ratio of 3/4 is used to support safari browser.
  video.width = video.width || 640;
  video.height = video.height || video.width * (3 / 4)

  return new Promise(function (resolve, reject) {
    navigator.mediaDevices
      .getUserMedia({
        audio: false,
        video: {
          facingMode: "environment"
        }
      })
      .then(stream => {
        window.localStream = stream;
        video.srcObject = stream
        video.onloadedmetadata = () => {
          video.play()
          resolve(true)
        }
      }).catch(function (err) {
        resolve(false)
      });
  });

}

    
  startVideo(video).then(function (status) {
    console.log("video started", status);
    if (status) {
      //threshButton.innerHTML=modelParams.scoreThreshold;
      updateNote.style.visibility='hidden';
      //flip_button.style.visibility='hidden';
      //document.getElementById('intro').style.visibility='hidden';
      runDetection();
    } else {
      updateNote.innerText = "Please enable video";
    }
  });
    </script>

</body>

</html>
